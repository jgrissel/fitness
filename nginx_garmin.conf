server {
    listen 80;
    server_name _;  # Catch-all for IP access

    # Forward /api/ requests to the API container
    # Strips /api/ prefix? No, let's keep it simple.
    # The API is mapped to port 8081 on Host.
    # Actually, we can just proxy /api/ path if the app handles it,
    # OR we make the API app handle root and we map /api here.
    # Let's map /api/ directly to the root of the API service if possible, or just forward as is.
    # Simpler: Map /api/ -> http://localhost:8081/
    
    location /api/ {
        # Note: API runs on 8081 on host
        proxy_pass http://localhost:8081/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Redirect root to Dashboard
    location / {
        proxy_pass http://localhost:8501/;
        proxy_set_header Host $host;
        # Websocket support for Streamlit
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
    }
}
